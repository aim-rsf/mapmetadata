<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>mapmetadata tutorial • mapmetadata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mapmetadata tutorial">
<script defer data-domain="pkgdown.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mapmetadata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/mapmetadata.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/HealthMetadata.html">Health metadata</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aim-rsf/mapmetadata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>mapmetadata tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/aim-rsf/mapmetadata/blob/main/vignettes/mapmetadata.Rmd" class="external-link"><code>vignettes/mapmetadata.Rmd</code></a></small>
      <div class="d-none name"><code>mapmetadata.Rmd</code></div>
    </div>

    
    
<p>For installation, set-up and basic usage refer to the package <a href="https://aim-rsf.github.io/mapmetadata/index.html">README.md</a>
file. In this tutorial, you will find more context on package inputs,
how to interact with package functions and interpret package
outputs.</p>
<div class="section level2">
<h2 id="preparing-for-mapping">Preparing for mapping<a class="anchor" aria-label="anchor" href="#preparing-for-mapping"></a>
</h2>
<p><img src="https://raw.githubusercontent.com/aim-rsf/mapmetadata/main/inst/outputs/BAR_360_NCCHD_2024-12-19-14-11-55.png" alt="example bar plot showing number of variables for each table alongside counts of whether variables have missing descriptions"></p>
<p>This bar plot is produced automatically when you run the
<code>[metadata_map](https://github.com/aim-rsf/mapmetadata/tree/main/R/metadata_map.R)</code>
function with the demo metadata file, which contains metadata about the
<strong>National Community Child Health Database (NCCHD).</strong></p>
<p>The bar plot shows us there are 13 tables in the dataset. The height
of the bar indicates the number of variables in that table:</p>
<ul>
<li>The ones with lots of variables (e.g. CHILD_TRUST) will take you
longer to process (caveat: see HDRUK Gateway screenshot below)</li>
<li>Some tables (e.g. CHE_HEALTHYCHILDWALESPROGRAMME) have a lot of
empty descriptions. An empty description means that this variable will
only have a label and a data type.</li>
</ul>
<p>It is important to note that this plot is only summarising
<em>variable</em> level metadata i.e. a description of what the variable
is. Some variables also require <em>value</em> level metadata i.e. what
does each value correspond to, 1 = Yes, 2 = No, 3 = Unknown. This
<em>value</em> level metadata can sometimes be found in lookup tables,
if it is not provided within the <em>variable</em> level
description.</p>
<p>The bar plot can help you understand the scope of the dataset, but
reference the HDRUK Gateway page for the fuller context. For instance,
table descriptions are not included in these structural metadata files
but they are included on the gateway:</p>
<p>For dataset NCCHD, used in the demo, the structural metadata was
downloaded from <a href="https://healthdatagateway.org/en/dataset/360" class="external-link uri">https://healthdatagateway.org/en/dataset/360</a>. Below, we
include a screenshot of this page; a user must click on the ‘Download
Data’ then ‘Structural Metadata’ in order to download the file. Please
note, we are working on API integration with this package to streamline
this for users.</p>
<p><img src="https://raw.githubusercontent.com/aim-rsf/mapmetadata/main/inst/outputs/NCCHD_gateway_download.png" alt="screenshot of HRDRUK gateway showing location to download structural metadata"></p>
<p>It is recommended to view the descriptions of each table to give you
more context on their contents and how to use them:</p>
<p><img src="https://raw.githubusercontent.com/aim-rsf/mapmetadata/main/inst/outputs/NCCHD_gateway_table.png" alt="screenshot of HRDRUK gateway showing table descriptions for the NCCHD dataset"></p>
</div>
<div class="section level2">
<h2 id="understanding-mapping-outputs">Understanding mapping outputs<a class="anchor" aria-label="anchor" href="#understanding-mapping-outputs"></a>
</h2>
<p>Running
<code>[metadata_map](https://github.com/aim-rsf/mapmetadata/tree/main/R/metadata_map.R)</code>
will run this function in demo mode (as explained in the README) and
generate four files in your project directory.</p>
<p>By default, the demo mode processes the first 5 variables in a table.
Running <code>metadata_map(demo_number = 20)</code> will process the
first 20 variables in a table. Here you can <a href="https://github.com/aim-rsf/mapmetadata/tree/main/inst/outputs/" class="external-link">view
outputs generated from this longer demo run</a>, which include:</p>
<ul>
<li>
<strong>BAR_360_NCCHD_timestamp.png</strong>
<ul>
<li>The bar plot that opened in your browser. It will save as a .html
file but you can choose the ‘Download plot as png’ option.</li>
</ul>
</li>
<li>
<strong>BAR_360_NCCHD_timestamp.csv</strong>
<ul>
<li>The data that created this bar plot.</li>
</ul>
</li>
<li>
<strong>MAPPING_360_NCCHD_CHILD_timestamp.csv</strong>
<ul>
<li>The mappings between variables in the CHILD table and the research
domains.</li>
</ul>
</li>
<li>
<strong>L-MAPPING_360_NCCHD_CHILD_timestamp.csv</strong>
<ul>
<li>The same mappings as the previous file, but saved in a longer
format. See the argument <code>long_output = TRUE</code> in
<code>[metadata_map](https://github.com/aim-rsf/mapmetadata/tree/main/R/metadata_map.R)</code>.
If <code>long_output = FALSE</code> was used, the long outputs can be
generated by directly calling the
<code>[map_convert](https://github.com/aim-rsf/mapmetadata/tree/main/R/map_convert.R)</code>
function.</li>
</ul>
</li>
<li>
<strong>MAPPING_LOG_360_NCCHD_CHILD_timestamp.csv</strong>
<ul>
<li>A log file that accompanies the MAPPING file, describing features of
the session and the table processed.</li>
</ul>
</li>
<li>
<strong>MAPPING_PLOT_360_NCCHD_CHILD_timestamp.png</strong>
<ul>
<li>A simple visual representation of the mappings, displaying the count
of each domain code.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="compare-mapping">Compare mapping<a class="anchor" aria-label="anchor" href="#compare-mapping"></a>
</h2>
<p>Running the function
<code>[map_compare](https://github.com/aim-rsf/mapmetadata/tree/main/R/map_compare.R)</code>
will allow you to compare the mappings from two sessions, perhaps two
different researchers. This function compares csv outputs from two
sessions, finds their differences, and asks for a consensus, creating a
new output file:</p>
<p><strong>CONSENSUS_MAPPING_360_NCCHD_CHILD_timestamp.csv</strong></p>
</div>
<div class="section level2">
<h2 id="using-a-custom-metadata-input-recommended">Using a custom metadata input (recommended)<a class="anchor" aria-label="anchor" href="#using-a-custom-metadata-input-recommended"></a>
</h2>
<p>Currently, the way to retrieve a metadata file that is compatible
with this package is to:</p>
<ol style="list-style-type: decimal">
<li>Visit the <a href="https://healthdatagateway.org/en/search?type=datasets" class="external-link">Health Data
Research Gateway</a> website</li>
<li>Browse for the dataset you want, click on it to move to its main
page</li>
<li>Click on ‘Download data’ button and select ‘Structural
Metadata’<br>
</li>
<li>Rename this file to be ‘ID_Name_Metadata.csv’ with ‘ID’ and ‘Name’
being changed depending on the specific dataset download</li>
</ol>
<p>The demo metadata file used in this package is <a href="https://github.com/aim-rsf/mapmetadata/tree/main/inst/inputs/360_NCCHD_Metadata.csv" class="external-link">360_NCCHD_Metadata.csv</a>,
with 360 being the ID given by HDRUK Gateway and NCCHD being the
abbreviation for the dataset name (National Community Child Health
Database).</p>
<p>Any metadata file in the same format as this download should work
with this package.</p>
<p>Run <code>data("metadata")</code> to load the demo metadata into your
R environment. This demo metadata is also included as a package file and
is retrieved using the <code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncchd_metadata_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"inputs/360_NCCHD_Metadata.csv"</span>, package <span class="op">=</span> <span class="st">"mapmetadata"</span><span class="op">)</span></span>
<span><span class="va">demo_domains_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"inputs/domain_list_demo.csv"</span>, package <span class="op">=</span> <span class="st">"mapmetadata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/metadata_map.html">metadata_map</a></span><span class="op">(</span>metadata_file <span class="op">=</span> <span class="va">ncchd_metadata_csv</span>, domain_file <span class="op">=</span> <span class="va">demo_domains_csv</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-a-custom-domain-list-input-recommended">Using a custom domain list input (recommended)<a class="anchor" aria-label="anchor" href="#using-a-custom-domain-list-input-recommended"></a>
</h2>
<p>You can use a custom domain list input instead of using the default,
e.g. <code>metadata_map(metadata_file = ID_Name_Metadata.csv, domain_file = my_domain_list.csv)</code>.</p>
<p>Run <code>data("domain_list")</code> to load the demo domain list
into your R environment (you can also read the package file with
<code>system.file("inputs/domain_list_demo.csv", package = "mapmetadata"</code>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"domain_list"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">print</span>(domain_list)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="dv">1</span>  NO MATCH <span class="sc">/</span> UNSURE</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="dv">2</span>           METADATA</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="dv">3</span>                 ID</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="dv">4</span>       DEMOGRAPHICS</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="dv">5</span> Socioeconomic info</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="dv">6</span>      Location info</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="dv">7</span>     Education info</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="dv">8</span>        Health info</span></code></pre></div>
<p>Change this csv domain file to be more specific to your research
domains (sometimes called latent variables or concepts) as these are
broad and generic categories for demo purposes.</p>
<p>It is strongly recommended to keep the first four domains (NO MATCH /
UNSURE, METADATA, ID, DEMOGRAPHICS). If you change them, you also have
to change the lookup table.</p>
</div>
<div class="section level2">
<h2 id="using-a-custom-lookup-table-input-advanced">Using a custom lookup table input (advanced)<a class="anchor" aria-label="anchor" href="#using-a-custom-lookup-table-input-advanced"></a>
</h2>
<p>Run <code>data("look_up")</code> to load the demo look up table into
your R environment (you can also read the package file with
<code>system.file("inputs/look_up.csv", package = "mapmetadata")</code>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"look_up"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">print</span>(look_up)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                      variable      domain_label domain_code</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="dv">1</span>                         <span class="cn">NA</span>   No Match <span class="sc">/</span> Unsure           <span class="dv">1</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="dv">2</span>                AVAIL_FROM_DT          Metadata           <span class="dv">2</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="dv">3</span>                        ALF_E                ID           <span class="dv">3</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="dv">4</span>                 MOTHER_ALF_E                ID           <span class="dv">3</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="dv">5</span>                  CHILD_ALF_E                ID           <span class="dv">3</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="dv">6</span>                         RALF                ID           <span class="dv">3</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="dv">7</span>                   ALF_STS_CD                ID           <span class="dv">3</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="dv">8</span>            MOTHER_ALF_STS_CD                ID           <span class="dv">3</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="dv">9</span>             CHILD_ALF_STS_CD                ID           <span class="dv">3</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="dv">10</span>                ALF_MTCH_PCT                ID           <span class="dv">3</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="dv">11</span>         MOTHER_ALF_MTCH_PCT                ID           <span class="dv">3</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="dv">12</span>          CHILD_ALF_MTCH_PCT                ID           <span class="dv">3</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="dv">13</span>     SERVICE_USER_LOCAL_ID_E                ID           <span class="dv">3</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="dv">14</span> MAT_SERVICE_USER_LOCAL_ID_E                ID           <span class="dv">3</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="dv">15</span>                 CLIENT_ID_E                ID           <span class="dv">3</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="dv">16</span>                         AGE      Demographics           <span class="dv">4</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="dv">17</span>                     MAT_AGE      Demographics           <span class="dv">4</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="dv">18</span>              MAT_AGE_AT_ASS      Demographics           <span class="dv">4</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="dv">19</span>                 CONTACT_AGE      Demographics           <span class="dv">4</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="dv">20</span>                         WOB      Demographics           <span class="dv">4</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="dv">21</span>                     MAT_WOB      Demographics           <span class="dv">4</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="dv">22</span>                         SEX      Demographics           <span class="dv">4</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="dv">23</span>         SERVICE_USER_SEX_CD      Demographics           <span class="dv">4</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="dv">24</span>             NENONATE_SEX_CD      Demographics           <span class="dv">4</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="dv">25</span>                      GENDER      Demographics           <span class="dv">4</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="dv">26</span>                        GNDR      Demographics           <span class="dv">4</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="dv">27</span>                     GNDR_CD      Demographics           <span class="dv">4</span></span></code></pre></div>
<p>The default lookup table (printed above) governs the automatic
categorisations. If you modify the default lookup file you must ensure
that all values contained in the domain_code column map to the the
domain_file in the way you intend. For example, we can see that the
domain_file has 8 domains, which will be labelled with 1-8 by the
function. If we included a ‘0’ or ‘9’ in the domain_code column of the
lookup file, they would have nothing to map to, and the function would
crash.</p>
</div>
<div class="section level2">
<h2 id="copying-across-tables">Copying across tables<a class="anchor" aria-label="anchor" href="#copying-across-tables"></a>
</h2>
<p>If you’re processing multiple tables (i.e. in run one of
<code>[metadata_map](https://github.com/aim-rsf/mapmetadata/tree/main/R/metadata_map.R)</code>
select table one, in run two select table two) save all outputs in the
same directory to enable table copying. This feature will speed up
categorisation and ensure consistency. If it finds other MAPPING files
with the same ID_Name in the output directory, and they contain
overlapping variables, it will automatically copy the mappings from this
previous table to the current table.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>Selection<span class="sc">:</span> <span class="dv">4</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>ℹ Processing Table <span class="dv">4</span> of <span class="dv">13</span> (CHILD)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>ℹ Copying from previous <span class="fu">session</span>(s)<span class="sc">:</span> MAPPING_360_NCCHD_CHILD_2025<span class="dv">-02-14-18-14</span><span class="fl">-01.</span>csv</span></code></pre></div>
<p>Instead of ‘AUTO CATEGORISED’ the note will say ‘COPED FROM: CHILD’
but you always have the option to manually override this copying during
your review, or turn it off altogether with the option
<code>table_copy = FASLE</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.turing.ac.uk/people/researchers/rachael-stickland" class="external-link">Rachael Stickland</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
